---
title: "Maize_Spread_Processes"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Maize_Spread_Processes}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup, include = FALSE, results = 'hide', echo = FALSE, warning = FALSE, message = FALSE, error = FALSE, results = 'hide'}

# devtools::install()
# devtools::load_all()
library(cropSpreadR)
require(ggh4x)
library(cropDiffusionR)

```

```{r load_data, include = FALSE, results = 'hide', echo = FALSE, warning = FALSE, message = FALSE, error = FALSE, results = 'hide'} 

# Load the temperature anomaly reconstruction from paleoMAT.
temp_anom <-
  readr::read_csv(
    "https://raw.githubusercontent.com/Archaeo-Programmer/paleoMAT/master/vignettes/tables/supp_table_s2.csv",
    show_col_types = FALSE
  ) %>%
  dplyr::rename(
    year = 1,
    anom = 2,
    ci = 3,
    se = 4
  )

# Load location data for each sample. Site location are not saved in this repository, as we want to ensure that archaeological site locations are protected. %>% str_remove("project_root/")
sf::sf_use_s2(FALSE)

MDB <- cropDiffusionR::maizeDB %>%
  dplyr::left_join(.,
                   readr::read_csv(
                     stringr::str_remove(
                       here::here("Paper 2/Maize_Database_Locations_DONT_DISTRIBUTE.csv"),
                       "cropSpreadR/"
                     ),
                     col_types = readr::cols()
                   ),
                   by = "LabID") %>%
  dplyr::mutate(Long1 = Long, Lat1 = Lat) %>%
  # Convert to spatial object
  sf::st_as_sf(coords = c("Long1", "Lat1"),
               crs = 4326) %>%
  sf::st_make_valid() %>%
  # Join to counties data to get county and state information.
  sf::st_join(SWUS_counties) %>%
  dplyr::mutate(county_st = ifelse(!is.na(REGION) &
                                     !is.na(NAME), paste(NAME, REGION, sep = ", "), NA)) %>%
  sf::st_drop_geometry() %>% 
  suppressMessages()

# Get modern annual accumulated growing degree days at each sample location. We use WorldClim 30 sec. (~1 km) for Mexico and use PRISM (~800 meters) for USA.
MDB_gdd_wc <- MDB %>%
  sf::st_as_sf(coords = c("Long", "Lat"), crs = 4326) %>%
  dplyr::select(LabID) %>%
  cropDiffusionR::extract_GDD(gdd_raster = cropDiffusionR::WorldClim_annual_gdd,
                              sites = .)

MDB_gdd_prism <- MDB %>%
  sf::st_as_sf(coords = c("Long", "Lat"), crs = 4326) %>%
  dplyr::select(LabID) %>%
  cropDiffusionR::extract_GDD(gdd_raster = cropSpreadR::PRISM_annual_gdd,  sites = .)

MDB_gdd <-
  dplyr::left_join(MDB_gdd_prism, MDB_gdd_wc, by = "LabID") %>%
  dplyr::mutate(GDD = dplyr::coalesce(GDD.x, GDD.y)) %>%
  dplyr::select(-c(GDD.x, GDD.y))


# Add GDD and elevation to maize dataset.
MDB_env <- MDB %>%
  dplyr::select(-Elevation_masl) %>%
  dplyr::left_join(., MDB_gdd, by = "LabID") %>%
  # Add elevation to dataset.
  dplyr::left_join(., cropSpreadR::MDB_elev, by = "LabID")


MDB3 <- MDB %>%
  dplyr::filter(Province %in% c("Arizona", "New Mexico", "Colorado", "Utah"))


mlr <- MDB_env %>%
  dplyr::group_by(SiteIDName) %>%
  dplyr::slice_min(Date) %>%
  dplyr::filter(Lat >= 30 & Date < 1500) %>%
  dplyr::mutate(bin = cut(
    Date,
    breaks = seq(-3700, 1500, 100))) %>% 
  dplyr::group_by(bin) %>% 
  dplyr::mutate(group = dplyr::cur_group_id()) %>% 
  dplyr::filter(LabID %in% maize_frontier_swus$LabID) %>% 
  dplyr::ungroup()

fit <- lm(Date ~ Lat + GDD + elevation, data = mlr)
summary(fit)

mlr %>%
  dplyr::select(Date, Lat, GDD, elevation) %>%
  #dplyr::select(Date, Lat) %>%
  tidyr::pivot_longer(-Date) %>%
  ggplot(aes(Date, value)) +
  geom_smooth(
    method = 'lm',
    formula = y ~ x,
    se = T,
    fullrange = TRUE
    #aes(color = name)
  ) +
  #scale_x_reverse() +
  geom_point() +
  facet_wrap(vars(name), scales = "free")

#load car package
library(car)

#produce added variable plots
avPlots(fit)


```


```{r Figure_1, fig.cap="Figure 1. TPS of earliest maize at each site.", echo = FALSE, warning = FALSE, message = FALSE, error = FALSE, results = 'hide',fig.keep = 'all', fig.width = 15.51, fig.height = 10.32, fig.align = "left"}

library(sp)
library(rgdal)
library(geosphere)
library(raster)
library(fields)

TPS_inter <- MDB %>%
  dplyr::group_by(SiteIDName) %>%
  dplyr::slice_max(MedianBP) %>%
  dplyr::filter(Lat >= 30 & Date < 1500)

x = TPS_inter$Long
y = TPS_inter$Lat
z = TPS_inter$MedianBP

# convert data to a SpatialPointsDataFrame object
xysp <- SpatialPointsDataFrame(
  matrix(c(x, y), ncol = 2),
  data.frame(ID = seq(1:length(x))),
  proj4string = CRS("+proj=longlat +ellps=WGS84 +datum=WGS84")
)

# use the distm function to generate a geodesic distance matrix in meters
mdist <- distm(xysp)

# cluster all points using a hierarchical clustering approach
hc <- hclust(as.dist(mdist), method = "complete")

# define the distance threshold, in this case 40 m
d = 6437.38

# define clusters based on a tree "height" cutoff "d" and add them to the SpDataFrame
xyp2 <- xysp
xyp2$clust <- cutree(hc, h = d)

df_clus <- as.data.frame(xyp2, z, TPS_inter$SiteIDName) %>%
  dplyr::group_by(clust) %>%
  dplyr::slice_max(z, with_ties = FALSE) %>%
  dplyr::ungroup() %>%
  dplyr::select(-c(ID, clust)) %>%
  dplyr::filter(!TPS_inter.SiteIDName %in% c("AA:12:745", "AA:12:232"))

xy <- data.frame(x = df_clus$coords.x1, y = df_clus$coords.x2)
z2 = df_clus$z
rast <- raster::raster(ext = extent(xy),
                       crs = 4326,
                       resolution = 0.01)

m <- fields::Tps(xy, z2)
surface <- raster::interpolate(rast, m)

png(
  here::here("vignettes/figures/Figure_1.png"),
  units = "in",
  width = 15.43,
  height = 13.15,
  res = 600
)

plot(
  surface,
  xlim = c(-113.7015, -104.7915),
  ylim = c(30.30626, 41.47626),
  col = wesanderson::wes_palette("Zissou1", 21, type = "continuous"),
  asp = NA,
  xaxt = 'n',
  yaxt = 'n',
  legend.args = list(
    text = "         cal BP \n",
    side = 3,
    font = 2,
    cex = 1.5
  ),
  legend.width = 1.25,
  legend.shrink = 0.75
)
contour(
  surface,
  asp = NA,
  add = TRUE,
  labcex = 1.1,
  xaxt = 'n',
  yaxt = 'n',
  vfont = c("sans serif", "bold")
)
maps::map(
  'state',
  add = TRUE,
  lwd = 1.5,
  lty = 1,
  col = "grey28"
)

dev.off()

```

```{r Figure_2, fig.cap="Figure 2. SPDs by county with the earliest maize plotted for each county.", echo = FALSE, warning = FALSE, message = FALSE, error = FALSE, results = 'hide',fig.keep = 'all', fig.width = 15.51, fig.height = 10.32, fig.align = "left"}

MDB3A <- MDB %>%
  dplyr::filter(Country == "USA") %>%
  dplyr::select(LabID, Long, Lat, SiteIDName, MedianBP) %>%
  dplyr::mutate(SiteIDName = ifelse(SiteIDName == "Willard Mounds", "42BO3", SiteIDName))

# Get sites that are on the northern maize frontier through time from cropDiffusionR package.
temp <- tempfile()
download.file(
  "https://raw.githubusercontent.com/Archaeo-Programmer/cropDiffusionR/master/vignettes/output/maize_frontier_swus.rds",
  temp
)
maize_frontier_swus <-
  readr::read_rds(temp, "maize_frontier_swus.rds")
unlink(temp)

maize_oldest <- sw_rc %>%
  dplyr::filter(stringr::str_detect(Taxa, "zea|Zea")) %>%
  dplyr::filter(LabID != "Beta-122953") %>%
  dplyr::filter(county_st %in% maize_frontier_swus$county_st)

maize_oldest2 <-
  rcarbon::calibrate(
    x = maize_oldest$Age,
    errors = maize_oldest$Error,
    calCurves = maize_oldest$calib,
    verbose = FALSE
  ) %>%
  summary() %>%
  dplyr::bind_cols(maize_oldest, .) %>%
  dplyr::select(county_st, MedianBP, LabID, SiteID, SiteName) %>%
  dplyr::group_by(county_st) %>%
  dplyr::slice_max(MedianBP, with_ties = FALSE) %>%
  dplyr::mutate(county_st = tools::toTitleCase(county_st)) %>%
  dplyr::left_join(.,
                   MDB %>% dplyr::select(LabID, SiteID, SiteName, SiteIDName),
                   by = "LabID") %>%
  dplyr::mutate(
    SiteID = dplyr::coalesce(SiteID.y, SiteID.x),
    SiteName = dplyr::coalesce(SiteName.y, SiteName.x),
    .keep = "unused"
  ) %>%
  dplyr::mutate(SiteNameID = dplyr::coalesce(SiteName, SiteID))

county_centroid <- SWUS_counties %>%
  sf::st_drop_geometry() %>%
  dplyr::select(county_st, centroid_lat) %>%
  dplyr::mutate(county_st = tools::toTitleCase(county_st))

by_county_changes <- SPD_county %>%
  dplyr::filter(county_st %in% maize_frontier_swus$county_st) %>%
  dplyr::mutate(county_st = tools::toTitleCase(county_st)) %>%
  dplyr::left_join(maize_oldest2, ., by = "county_st") %>%
  dplyr::left_join(
    .,
    SWUS_counties %>%
      sf::st_drop_geometry() %>%
      dplyr::select(county_st, centroid_lat) %>%
      dplyr::mutate(county_st = tools::toTitleCase(county_st)),
    by = "county_st"
  ) %>%
  dplyr::arrange(desc(centroid_lat)) %>%
  # Remove all columns with word site, except for SiteNameID, and remove name and region columns.
  dplyr::select(-c(starts_with("Site", vars = names(.)[stringr::str_detect(names(.), "SiteNameID", negate = TRUE)]), NAME, REGION, LabID)) %>%
  tidyr::unnest(cols = c(spds)) %>%
  dplyr::mutate(
    MedianBP = ifelse(MedianBP == calBP, MedianBP, NA),
    SiteNameID = ifelse(!is.na(MedianBP), SiteNameID, NA)
  ) %>%
  dplyr::mutate(county_st = paste0(county_st, " (n = ", n, ")"))


spd_plot <-
  ggplot(data = by_county_changes, aes(y = PrDens, x = calBP)) +
  geom_line() +
  geom_point(
    aes(y = PrDens, x = MedianBP),
    size = 2.75,
    color = "red",
    inherit.aes = FALSE
  ) +
  geom_label_repel(
    aes(y = PrDens, x = MedianBP, label = SiteNameID),
    color = "red",
    cex = 5,
    show.legend  = F,
    min.segment.length = unit(0.1, 'lines'),
    box.padding = 1,
    nudge_x = -550,
    nudge_y = 0.35,
    fill = alpha(c("white"), 0.6),
    label.size = NA
  ) +
  theme_bw() +
  scale_x_reverse(breaks = seq(0, 6000, 1000), limits = c(6000, 0)) +
  scale_y_continuous(
    breaks = function(x)
      seq(0, max(x), length.out = 3),
    labels = function(y)
      sprintf("%.2f", y)
  ) +
  facet_wrap( ~ factor(county_st, levels = unique(by_county_changes$county_st)),
              scales = "free_y",
              ncol = 1) +
  xlab("Years cal BP") +
  ylab("Summed Probability") +
  theme(
    panel.spacing = unit(1, "lines"),
    strip.text.x = element_text(
      size = 16,
      family = "Helvetica",
      face = "bold"
    ),
    axis.ticks.length = unit(0.125, "inch"),
    #ggh4x.axis.ticks.length.minor = rel(0.5),
    panel.border = element_blank(),
    panel.grid.major = element_blank(),
    axis.text = element_text(
      size = 20,
      colour = "black",
      family = "Helvetica"
    ),
    axis.title.y = element_text(
      size = 28,
      family = "Helvetica",
      margin = margin(
        t = 10,
        r = 5,
        b = 10,
        l = 10
      )
    ),
    axis.title.x = element_text(
      size = 28,
      family = "Helvetica",
      margin = margin(
        t = 5,
        r = 10,
        b = 10,
        l = 10
      )
    ),
    panel.grid.minor = element_blank(),
    axis.line = element_line(colour = "black"),
    plot.margin = margin(
      t = 5,
      r = 25,
      b = 5,
      l = 5
    )
  )

spd_plot

ggplot2::ggsave(
  filename = here::here("vignettes/figures/Figure_2.png"),
  plot = spd_plot,
  width = 16,
  height = 18,
  dpi = 600
)


```

```{r Figure_3, fig.cap="Figure 3. Box plots showing elevation, GDD, and latitude for each sample in our maize database, which includes 1,043 samples) through time (Gillreath-Brown and Kohler n.d. 2022). The samples have been binned into 500 year time slices and plotted on the midpoint of the 500 year time bin.", echo = FALSE, warning = FALSE, message = FALSE, error = FALSE, results = 'hide',fig.keep = 'all', fig.width = 15.51, fig.height = 10.32, fig.align = "left"}

MDB_env2 <- MDB_env %>%
  dplyr::filter(Date < 1500) %>%
  dplyr::group_by(gr = cut(Date,
                           breaks = seq(-4500, 1500,500),
                           labels = seq(-4250, 1250,500))) %>% 
  dplyr::mutate(date2 = as.numeric(as.character(gr))) %>% 
  dplyr::ungroup() %>% 
  dplyr::select(-gr) %>% 
  dplyr::arrange(date2) %>% 
  dplyr::rename(Latitude = Lat, Elevation = elevation)

env_summaries <- MDB_env2 %>% 
  dplyr::summarise(across(c(Latitude, GDD, Elevation), ~ mean(.x, na.rm = TRUE)))

env_summaries_bp <-
  MDB_env2 %>%
  dplyr::select(date2, Latitude, GDD, Elevation) %>%
  tidyr::pivot_longer(-date2) %>%
  ggplot(aes(
    x = factor(date2),
    y = value,
    fill = factor(name)
  )) +
  geom_boxplot() +
  facet_grid(vars(name), scales = "free") +
  labs(fill = "") +
  xlab("Years BC/AD") +
  ylab("Value") +
  theme_bw() +
  theme(
    strip.text.y = element_text(size = 12),
    legend.key.size = unit(1.5, "cm"),
    legend.text = element_text(size = 12),
    axis.ticks.length = unit(0.125, "inch"),
    #ggh4x.axis.ticks.length.minor = rel(0.5),
    axis.text = element_text(
      size = 26,
      colour = "black",
      family = "Helvetica"
    ),
    axis.title.y = element_text(
      size = 28,
      family = "Helvetica",
      margin = margin(
        t = 10,
        r = 5,
        b = 10,
        l = 10
      )
    ),
    axis.title.x = element_text(
      size = 28,
      family = "Helvetica",
      margin = margin(
        t = 5,
        r = 10,
        b = 10,
        l = 10
      )
    ),
    axis.line = element_line(colour = "black"),
    plot.margin = margin(
      t = 5,
      r = 25,
      b = 5,
      l = 5
    )
  )

ggplot2::ggsave(
  filename = here::here("vignettes/figures/Figure_3.png"),
  plot = env_summaries_bp,
  width = 15.51,
  height = 10.32,
  dpi = 600
)


```

```{r spd_county_maps}

SW_counties <- tigris::counties(c("Arizona", "New Mexico", "Colorado", "Utah"))

ggplot() +
  geom_sf(data = SW_counties, color="black",
                   fill="white", size=0.25)



```


# Exploration Code
```{r code_exploration} 


library(tidyverse)

MDB2 <- MDB %>% 
  filter(Lat >= 30) %>% 
  arrange(Lat, Long)

interpolated <- interp(MDB2$Long, MDB2$Lat, MDB2$MedianBP, 
                       duplicate = "mean",    #you have duplicated values
                       output = "grid")

#convert this to a long form dataframe
interp_df <- expand_grid(i = seq_along(interpolated$x), 
                         j = seq_along(interpolated$y)) %>% 
  dplyr::mutate(lon = interpolated$x[i],
         lat = interpolated$y[j],
         emissions = map2_dbl(i, j, ~interpolated$z[.x,.y])) %>% 
  dplyr::select(-i, -j)

#then you can use this in your plot
ggplot()+
  geom_point(data = MDB2, aes(x = Long, y = Lat), col = "blue") +
  geom_contour(data = interp_df, aes(x = lon, y = lat, z = emissions), binwidth = 300) + 
  geom_text_contour(data = interp_df, aes(x = lon, y = lat, z = emissions), binwidth = 300) +
    geom_sf(
    data = cropDiffusionR::usa_mexico_states,
    color = "#2b2b2b",
    fill = "transparent",
    size = 0.4,
    inherit.aes = FALSE
  ) +
  scale_y_continuous(limits = c(30, 42)) +
  scale_x_continuous(limits = c(-115, -104))

library(akima)

fld <- with(MDB2, interp(x = Long, y = Lat, z = MedianBP, duplicate = "mean"))

ok <- filled.contour(x = fld$x,
               y = fld$y,
               z = fld$z,
               color.palette =
                 colorRampPalette(wes_palette("Zissou1", 21, type = "continuous")),
               xlab = "Longitude",
               ylab = "Latitude",
               main = "Years BP",
               #plot.axes=maps::map('state',add=T))
               plot.axes = { contour(fld$x,fld$y,fld$z,  
                                 drawlabels = TRUE, axes = FALSE, 
                                 frame.plot = FALSE, add = TRUE);
             axis(1); axis(2); maps::map('state',add=T); points(5, 5) })


library(raster)
library(fields)


xy <- data.frame(x = MDB2$Long, y = MDB2$Lat)
z = MDB2$MedianBP
rast <- raster(ext=extent(xy), crs=4326, resolution = 0.01)

m <- fields::Tps(xy, z)
surface <- raster::interpolate(rast, m)

plot(surface)
contour(surface, add = TRUE)


library(akima)
library(metR)
library("wesanderson")
library(scales)

MDB2 <- MDB %>% 
  dplyr::filter(Lat >= 30 & Date <= 1500) %>% 
  dplyr::arrange(desc(MedianBP)) %>% 
  dplyr::group_by(Long, Lat) %>% 
  dplyr::slice_max(MedianBP, with_ties = FALSE)

fld <- with(df_clus,
            interp(
              x = coords.x1,
              y = coords.x2,
              z = z,
              xo = seq(min(coords.x1), max(coords.x1), length = 800),
              yo = seq(min(coords.x2), max(coords.x2), length = 800)
              #duplicate = "mean"
            ))

gdat <- interp2xyz(fld, data.frame = TRUE)

ok <- ggplot(gdat) +
  aes(x = x,
      y = y,
      z = z,
      fill = z) +
  geom_tile() +
  coord_equal() +
  stat_contour(aes(fill= fit <<- ..level..), geom="polygon", binwidth=300) + 
  geom_contour(color = "white", alpha = 0.8) +
  geom_text_contour(binwidth = 300) +
  scale_fill_gradientn(colors = wes_palette("Zissou1", 21, type = "continuous"),
                       na.value = "transparent", name="Years BP") +
  theme_bw() +
  scale_y_continuous(limits = c(30, 42)) +
  scale_x_continuous(limits = c(-115, -104)) +
  geom_sf(
    data = cropDiffusionR::usa_mexico_states,
    color = "#2b2b2b",
    fill = "transparent",
    size = 0.4,
    inherit.aes = FALSE
  ) +
  #geom_point(data = MDB2, aes(x = Long, y = Lat), size = 3, inherit.aes = FALSE) +
  xlab("") +
  ylab("")


hello <- ggplot2::ggplot_build(ok)$data[[2]]

out <- hello %>% 
  dplyr::select(year = order, Long = x, Lat = y) %>% 
  sf::st_as_sf(coords = c("Long", "Lat"), crs = 4326, remove = FALSE) %>% 
  dplyr::bind_cols(., gdd = terra::extract(x = cropDiffusionR::NASW_gdd, y = .)) %>% 
  dplyr::filter(!is.na(gdd)) %>% 
  sf::st_drop_geometry() %>% 
  dplyr::group_by(year) %>% 
  summarise(Lat = mean(Lat), gdd = mean(gdd)) %>% 
  dplyr::arrange(desc(year)) %>% 
  dplyr::mutate(deltaLat = Lat - lag(Lat),
                deltaGDD = gdd - lag(gdd),
                date = rcarbon::BPtoBCAD(year))


# Change in latitude.
out %>%
  ggplot2::ggplot(aes(x = date, y = Lat)) +
  geom_line(size = 2, color = "#A60F2D") +
  xlab("Years BC/AD") +
  ylab("Latitude") +
  scale_x_continuous(breaks = seq(-2600, 1100, 300)) +
  # scale_y_continuous(
  #   breaks = seq(-0.7, 0, 0.1),
  #   limits = c(-0.7, 0),
  #   minor_breaks = seq(-0.65,-0.05, by = 0.05),
  #   guide = "axis_minor"
  # ) +
  theme_bw() +
  theme(
    axis.ticks.length = unit(0.125, "inch"),
    #ggh4x.axis.ticks.length.minor = rel(0.5),
    panel.border = element_blank(),
    panel.grid.major = element_blank(),
    axis.text = element_text(
      size = 26,
      colour = "black",
      family = "Helvetica"
    ),
    axis.title.y = element_text(
      size = 28,
      family = "Helvetica",
      margin = margin(
        t = 10,
        r = 5,
        b = 10,
        l = 10
      )
    ),
    axis.title.x = element_text(
      size = 28,
      family = "Helvetica",
      margin = margin(
        t = 5,
        r = 10,
        b = 10,
        l = 10
      )
    ),
    panel.grid.minor = element_blank(),
    axis.line = element_line(colour = "black"),
    plot.margin = margin(
      t = 5,
      r = 25,
      b = 5,
      l = 5
    )
  )

# Change in gdd (delta)
out %>%
  ggplot2::ggplot(aes(x = date, y = deltaGDD)) +
  geom_line(size = 2, color = "#A60F2D") +
  xlab("Years BC/AD") +
  ylab("Delta GDD") +
  scale_x_continuous(breaks = seq(-2600, 1100, 300)) +
  scale_y_reverse(
    breaks = seq(-4500, 500, 500)
  ) +
  theme_bw() +
  theme(
    axis.ticks.length = unit(0.125, "inch"),
    #ggh4x.axis.ticks.length.minor = rel(0.5),
    panel.border = element_blank(),
    panel.grid.major = element_blank(),
    axis.text = element_text(
      size = 26,
      colour = "black",
      family = "Helvetica"
    ),
    axis.title.y = element_text(
      size = 28,
      family = "Helvetica",
      margin = margin(
        t = 10,
        r = 5,
        b = 10,
        l = 10
      )
    ),
    axis.title.x = element_text(
      size = 28,
      family = "Helvetica",
      margin = margin(
        t = 5,
        r = 10,
        b = 10,
        l = 10
      )
    ),
    panel.grid.minor = element_blank(),
    axis.line = element_line(colour = "black"),
    plot.margin = margin(
      t = 5,
      r = 25,
      b = 5,
      l = 5
    )
  )


# GDD 
out %>%
  ggplot2::ggplot(aes(x = date, y = gdd)) +
  geom_line(size = 2, color = "#A60F2D") +
  xlab("Years BC/AD") +
  ylab("GDD") +
  scale_x_continuous(breaks = seq(-2600, 1100, 300)) +
  scale_y_reverse(
    breaks = seq(1000, 4000, 500)
  ) +
  theme_bw() +
  theme(
    axis.ticks.length = unit(0.125, "inch"),
    #ggh4x.axis.ticks.length.minor = rel(0.5),
    panel.border = element_blank(),
    panel.grid.major = element_blank(),
    axis.text = element_text(
      size = 26,
      colour = "black",
      family = "Helvetica"
    ),
    axis.title.y = element_text(
      size = 28,
      family = "Helvetica",
      margin = margin(
        t = 10,
        r = 5,
        b = 10,
        l = 10
      )
    ),
    axis.title.x = element_text(
      size = 28,
      family = "Helvetica",
      margin = margin(
        t = 5,
        r = 10,
        b = 10,
        l = 10
      )
    ),
    panel.grid.minor = element_blank(),
    axis.line = element_line(colour = "black"),
    plot.margin = margin(
      t = 5,
      r = 25,
      b = 5,
      l = 5
    )
  )

```

